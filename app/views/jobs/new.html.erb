<div class="custom-row">
<h1>Neuen Auftrag erfassen</h1>
<%= hidden_field_tag 'main_job_id',  @job.id %>
<%= hidden_field_tag 'form_type', "new" %>

  <%= form_for(@job) do |f| %>
    <%= hidden_field_tag 'job_amount',  @job_amount %>
    <div class="large-8 small-12 columns">
      <% if @job.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@job.errors.count, "error") %> <%= t "jobs.prevented_from_save" %></h2>

          <ul>
          <% @job.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %>
      <% if current_user.is_sixt? %>
      <div class="field row">
        <h3>Wie viele Autos wollen Sie erfassen?</h3><br>
        Aktuell gewählte Anzahl: <%= @job_amount %><br>
        <nav id="primary_nav_wrap">
        <ul>
          <li><a href="#">Anzahl auswählen</a>
            <ul>
              <% (1..20).to_a.each do |i| %>
                <li><%= link_to( i, job_multible_cars_path( :job_amount => i )) %></li>
              <% end %>
            </ul>
          </li>
        </ul>
      </div>
      <% end %>
      <div class="field row">
      <h3>Startpunkt</h3><br>
        Startpunkte hier filtern <input id="from_filter" type="text">
        <%= f.select :from_id, @addresses.collect {|a| [ "#{a.address_short}, #{a.address} #{a.zip_code} #{a.city} #{a.country}", a.id ] }%>
      </div>
      <div class="field row">
        <h3>Endpunkt</h3><br>
        Endpunkte hier filtern <input id="to_filter" type="text">
        <%= f.select :to_id, @addresses.collect {|a| [ "#{a.address_short}, #{a.address} #{a.zip_code} #{a.city} #{a.country}", a.id ] }%>
      </div>
      <div class="row">
        <div class="field large-8 columns">
          <h3>Fahrer</h3><br>
          Fahrer hier filtern <input id="driver_filter" type="text">
          <%= f.select :driver_id, options_from_collection_for_select(@drivers, "id", "fullname_id")%>
        </div>
        <div class="field large-4 columns">
          <h3>Kostenstelle</h3><br>
          <%= f.text_field :cost_center_id %>
        </div>
      </div>
      <div class="row lightgray">
        <div class="field large-4 columns">
          <h3><%= f.label :Fahrzeugmarke %></h3><br>
          <%= f.text_field :car_brand %>
        </div>
        <div class="field large-4 columns">
          <h3><%= f.label :Fahrzeugtype %></h3><br>
          <%= f.text_field :car_type %>
        </div>
        <div class="field large-4 columns">
          <h3><%= f.label :Kennzeichen %></h3><br>
          <%= f.text_field :registration_number %>
        </div>
      </div>
      <div class="row lightgray">
        <% ( @job_amount.to_i - 1 ).times do |i| %>
          <div class="field large-4 columns">
            <h3><%= f.label :Fahrzeugmarke %></h3><br>
            <% if @job_values[i].is_a? Hash %>
              <%= text_field_tag "car_brand" + "_#{i}", @job_values[i]["car_brand"] %>
            <% else %>
              <%= text_field_tag "car_brand" + "_#{i}" %>
            <% end %>
          </div>
          <div class="field large-4 columns">
            <h3><%= f.label :Fahrzeugtype %></h3><br>
            <% if @job_values[i].is_a? Hash %>
              <%= text_field_tag "car_type" + "_#{i}", @job_values[i]["car_type"] %>
            <% else %>
              <%= text_field_tag "car_type" + "_#{i}" %>
            <% end %>
          </div>
          <div class="field large-4 columns">
            <h3><%= f.label :Kennzeichen %></h3><br>
            <% if @job_values[i].is_a? Hash %>
              <%= text_field_tag "registration_number" + "_#{i}", @job_values[i]["registration_number"] %>
            <% else %>
              <%= text_field_tag "registration_number" + "_#{i}" %>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="row">
        <div class="field large-6 columns">
          <h3><%= f.label "Abholung" %></h3><br>
          <%= f.text_field :scheduled_collection_time %>
        </div>
        <div class="field large-6 columns">
          <h3><%= f.label "Lieferung" %></h3><br>
          <%= f.text_field :scheduled_delivery_time %>
        </div>
      </div>
      <% if current_user.is_intern? %>
      <div class="row lightgray">
        <div class="field large-4 columns">
          <h3><%= f.label "chassis_number", :Fahrgestellnummer %></h3><br>
          <%= f.text_field :chassis_number %>
        </div>
        <div class="field large-4 columns">
          <h3><%= f.label "mileage_delivery", "Kilometerstand Abholung" %></h3><br>
          <%= f.text_field :mileage_delivery %>
        </div>
        <div class="field large-4 columns">
          <h3><%= f.label "mileage_collection", "Kilometerstand Lieferung" %></h3><br>
          <%= f.text_field :mileage_collection %>
        </div>
      </div>
      <div class="row">
        <div class="field large-4 columns">
          <h3><%= f.label :Auftragsbemerkungen %></h3><br>
          <%= f.text_field :job_notice %>
        </div>
        <div class="field large-4 columns">
          <h3><%= f.label :Transportbemerkungen %></h3><br>
          <%= f.text_field :transport_notice %>
        </div>
        <div class="field large-4 columns">
          <h3><%= f.label "Transportbemerkungen extern" %></h3><br>
          <%= f.text_field :transport_notice_extern %>
        </div>
      </div>
        <div class="field">
          <h3><%= f.label :shuttle %></h3><br>
          <%= f.check_box :shuttle %>
        </div>
        <div id="shuttle_jobs_outer_wrapper">
          <table id="shuttle_jobs" class="display" data-source="<%= jobs_url(format: "json") %>">
            <thead>
              <tr>
                <th class="dont_show">id</th>
                <th><%= t "jobs.add" %></th>
                <th>Auftragnummer</th>
                <th>Name</th>
                <th>Von</th>
                <th>Nach</th>
                <th>Erstellungsdatum</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      <% end %>
    </div>
    <div class="large-4 small-12 columns sidebar">
      <%= hidden_field_tag 'co_jobs',  '' %>
      <h2>Auftragszusammenfassung:</h2>
      <table>
          <tr><td>Fahrername:</td><td><span id="drivername"></span></td></tr>
          <tr><td>Startpunkt:</td><td><span id="from"></span></td></tr>
          <tr><td>Endpunkt:</td><td><span id="to"></span></td></tr>
          <tr><td>Kostenstelle:</td><td><span id="cost-center"></span></td></tr>
          <tr><td>Fahrzeugmarke:</td><td><span id="car_brand"></span></td></tr>
          <tr><td>Fahrzeugtype:</td><td><span id="car_type"></span></td></tr>
          <tr><td>Kennzeichen:</td><td><span id="registration_number"></span></td></tr>
          <tr><td>Abholdatum:</td><td><span id="scheduled_collection_time"></span></td></tr>
          <tr><td>Lieferdatum:</td><td><span id="scheduled_delivery_time"></span></td></tr>
        </table>
      <div id="shuttle-co-drivers">
        <table>
          <thead>
            <th>Mitfahrer</th>
            <th>Auftragsnummer</th>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <div class="actions">
        <%= f.submit %>
      </div>
    </div>
  <% end %>
</div>